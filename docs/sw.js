const CACHE_NAME="story-app-v1",IMAGE_CACHE="image-cache",API_CACHE="api-cache",STATIC_ASSETS=["/","/index.html","/manifest.json","/icons/icon-192x192.png","/assets/images/fallback.png"];self.addEventListener("install",(e=>{console.log("[SW] Installing..."),e.waitUntil(caches.open(CACHE_NAME).then((e=>e.addAll(STATIC_ASSETS)))),self.skipWaiting()})),self.addEventListener("activate",(e=>{console.log("[SW] Activating..."),e.waitUntil(caches.keys().then((e=>Promise.all(e.map((e=>{if(![CACHE_NAME,IMAGE_CACHE,API_CACHE].includes(e))return caches.delete(e)})))))),self.clients.claim()})),self.addEventListener("fetch",(e=>{const t=new URL(e.request.url);"GET"===e.request.method&&("https://story-api.dicoding.dev"===t.origin&&t.pathname.startsWith("/images/")?e.respondWith(caches.open(IMAGE_CACHE).then((t=>t.match(e.request).then((s=>s||fetch(e.request).then((s=>(s.ok&&t.put(e.request,s.clone()),s))).catch((()=>caches.match("/assets/images/fallback.png")))))))):"https://story-api.dicoding.dev"===t.origin&&t.pathname.startsWith("/v1/stories/story-")?e.respondWith(fetch(e.request).then((e=>{if(e.ok)return e;throw new Error("Response not OK")})).catch((()=>new Response(JSON.stringify({error:!0,message:"Detail tidak tersedia saat offline."}),{status:200,headers:{"Content-Type":"application/json"}})))):"https://story-api.dicoding.dev"!==t.origin||"/v1/stories"!==t.pathname?e.respondWith(caches.match(e.request).then((t=>t||fetch(e.request).catch((()=>caches.match("/index.html")))))):e.respondWith(caches.open(API_CACHE).then((t=>fetch(e.request).then((s=>(s.ok&&t.put(e.request,s.clone()),s))).catch((()=>t.match(e.request)))))))})),self.addEventListener("push",(function(e){let t={};try{t=e.data.json()}catch(e){t={title:"Story App",message:"Ada notifikasi baru!"}}const s=t.title||"Story App",n={body:t.message||"Notifikasi dari server.",icon:"/icons/icon-192x192.png",badge:"/icons/icon-192x192.png"};e.waitUntil(self.registration.showNotification(s,n))}));